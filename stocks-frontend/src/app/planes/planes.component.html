<div class="app">
<aside class="sidebar">
    <div class="logo">PlazApp Admin</div>
    <nav class="nav">
      <a href="/">🏠 Dashboard</a>
      <a href="/modulos">🧩 Módulos</a>
      <a href="/planes" class="active">📦 Planes</a>
      <a href="/plazas">🏢 Plazas</a>
      <a href="/suscripciones">🔁 Suscripciones</a>
    </nav>
    <div style="margin-top:auto;font-size:13px;color:#cfcfcf">© KodeHaus</div>
  </aside>

  <div class="container">
    <header class="header">
      <div style="margin-right:12px;text-align:right">
        <div class="small">Admin Entidad de Gobierno</div>
      </div>
      <div class="avatar" title="Admin"></div>
    </header>
    <main class="content">
      <h2 style='margin-top:6px;margin-bottom:18px'>Planes del Sistema</h2>
      
      <div class="toolbar">
        <div class="small">Configurar planes de suscripción</div>
        <button class="btn" (click)="openCreateModal()">+ Crear Plan</button>
      </div>

      <!-- Loading state -->
      <div *ngIf="loading" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Cargando planes...</p>
      </div>

      <!-- Plans grid -->
      <div *ngIf="!loading" class="cards-grid">
        <div *ngFor="let plan of planes" class="plan-card">
          <h3>{{ plan.tipo }}</h3>
          <div class="small">Módulos incluidos: {{ plan.numModulos }}</div>
          <div class="small">Usuarios soportados: {{ formatUsers(plan.numUsuarios) }}</div>
          <div class="price">{{ formatPrice(plan.precio) }} / mes</div>
          <div class="plan-actions">
            <button class="btn edit-btn" (click)="openEditModal(plan)">Editar</button>
            <button class="btn delete-btn" (click)="confirmDelete(plan)">Eliminar</button>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!loading && planes.length === 0" class="empty-state">
        <div class="empty-icon">📦</div>
        <h3>No hay planes configurados</h3>
        <p>Crea tu primer plan para comenzar</p>
        <button class="btn" (click)="openCreateModal()">+ Crear Primer Plan</button>
      </div>

      <!-- Statistics card -->
      <div *ngIf="!loading && planes.length > 0" class="stats-card">
        <h4>Estadísticas de Planes</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ planes.length }}</span>
            <span class="stat-label">Planes Totales</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ formatPrice(getTotalValue()) }}</span>
            <span class="stat-label">Valor Total</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ getTotalModules() }}</span>
            <span class="stat-label">Módulos Totales</span>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Create/Edit Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ editingPlan ? 'Editar Plan' : 'Crear Nuevo Plan' }}</h3>
        <button class="close-btn" (click)="closeModal()">×</button>
      </div>
      
      <form class="modal-form" (ngSubmit)="savePlan()">
        <div class="form-row">
          <label for="tipo">Nombre del Plan</label>
          <input 
            type="text" 
            id="tipo" 
            [(ngModel)]="planForm.tipo" 
            name="tipo"
            class="input"
            placeholder="Ej: Básico, Avanzado, Premium"
            required
          >
        </div>
        
        <div class="form-row">
          <label for="numModulos">Número de Módulos</label>
          <input 
            type="number" 
            id="numModulos" 
            [(ngModel)]="planForm.numModulos" 
            name="numModulos"
            class="input"
            min="1"
            required
          >
        </div>
        
        <div class="form-row">
          <label for="numUsuarios">Número de Usuarios</label>
          <input 
            type="number" 
            id="numUsuarios" 
            [(ngModel)]="planForm.numUsuarios" 
            name="numUsuarios"
            class="input"
            min="0"
            required
          >
        </div>
        
        <div class="form-row">
          <label for="precio">Precio Mensual (COP)</label>
          <input 
            type="number" 
            id="precio" 
            [(ngModel)]="planForm.precio" 
            name="precio"
            class="input"
            min="0"
            step="0.01"
            required
          >
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn cancel-btn" (click)="closeModal()">Cancelar</button>
          <button type="submit" class="btn save-btn">
            {{ editingPlan ? 'Actualizar' : 'Crear' }} Plan
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
    <div class="modal delete-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirmar Eliminación</h3>
        <button class="close-btn" (click)="cancelDelete()">×</button>
      </div>
      
      <div class="delete-content">
        <div class="warning-icon">⚠️</div>
        <p>¿Estás seguro de que deseas eliminar el plan <strong>{{ planToDelete?.tipo }}</strong>?</p>
        <p class="small">Esta acción no se puede deshacer.</p>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn cancel-btn" (click)="cancelDelete()">Cancelar</button>
        <button type="button" class="btn delete-btn" (click)="deletePlan()">Eliminar</button>
      </div>
    </div>
  </div>
</div>